<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Browse Cars - CarFinder</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="theme-light">
  <nav class="nav">
    <div class="nav-left"><a href="index.html" class="brand">CarFinder</a></div>
    <ul class="nav-right">
      <li><a href="index.html">Home</a></li>
      <li><a href="find.html">Find</a></li>
      <li><a href="compare.html">Compare</a></li>
      <li><a href="wishlist.html">Wishlist</a></li>
    </ul>
  </nav>

  <main class="browse-page container">
    <div class="controls-row">
      <input id="searchInput" placeholder="Search brand or model..." />
      <select id="brandFilter"><option value="">All brands</option></select>
      <select id="bodyFilter"><option value="">All body types</option></select>
      <select id="fuelFilter"><option value="">All fuels</option></select>
      <input id="minPrice" placeholder="Min L" style="width:80px"/>
      <input id="maxPrice" placeholder="Max L" style="width:80px"/>
      <button id="clearFilters" class="btn ghost">Clear</button>
    </div>
    <div id="resultsGrid" class="grid"></div>
  </main>

  <footer class="footer">© CarFinder — Demo site</footer>

  <script src="data.js"></script>
  <script src="script.js"></script>
  <script>
  // enhanced browse with filters, wishlist, compare and details link
  document.addEventListener('DOMContentLoaded', ()=>{
    const brands = [...new Set(cars.map(c=>c.brand))].sort();
    const bodies = [...new Set(cars.map(c=>c.body))].sort();
    const fuels = [...new Set(cars.map(c=>c.fuel))].sort();
    const bf = document.getElementById('brandFilter');
    brands.forEach(b=>{ const o=document.createElement('option'); o.value=b; o.innerText=b; bf.appendChild(o); });
    const bo = document.getElementById('bodyFilter'); bodies.forEach(b=>{ const o=document.createElement('option'); o.value=b; o.innerText=b; bo.appendChild(o); });
    const fu = document.getElementById('fuelFilter'); fuels.forEach(f=>{ const o=document.createElement('option'); o.value=f; o.innerText=f; fu.appendChild(o); });

    const qInput = document.getElementById('searchInput');
    const grid = document.getElementById('resultsGrid');

    function scoreAndFilter(){
      const q = qInput.value.toLowerCase();
      const brandSel = bf.value; const bodySel = bo.value; const fuelSel = fu.value;
      const minP = parseFloat(document.getElementById('minPrice').value||'-1');
      const maxP = parseFloat(document.getElementById('maxPrice').value||'9999');
      // read answers for smarter scoring
      const stored = JSON.parse(localStorage.getItem('cf_answers')||'null');
      let list = cars.map(c=>({c,score:0}));
      list.forEach(item=>{
        const car=item.c;
        // base score by text match
        if(q && (car.brand+' '+car.model).toLowerCase().includes(q)) item.score+=30;
        // apply filters
        if(brandSel && car.brand!==brandSel) item.score=-9999;
        if(bodySel && car.body!==bodySel) item.score=-9999;
        if(fuelSel && car.fuel!==fuelSel) item.score=-9999;
        if(!(car.price>=minP && car.price<=maxP)) item.score=-9999;
        // if we have answers, add weighted matching
        if(stored){
          if(stored.body && car.body.toLowerCase().includes(stored.body.toLowerCase())) item.score+=40;
          if(stored.fuel && car.fuel.toLowerCase()===stored.fuel.toLowerCase()) item.score+=30;
          if(stored.budget){
            const b = stored.budget;
            const p = car.price;
            if(b==='<5' && p<5) item.score+=15;
            if(b==='5-10' && p>=5 && p<=10) item.score+=15;
            if(b==='10-20' && p>10 && p<=20) item.score+=15;
            if(b==='>20' && p>20) item.score+=15;
          }
          if (stored) {
  if (stored.country && stored.country.length > 0) {
    if (car.country && car.country.toLowerCase() === stored.country.toLowerCase()) item.score += 50;
    else item.score -= 20; // deprioritize cars not in selected country
  }
  // existing scoring rules for body/fuel/budget/brand...
}

          if(stored.brand && stored.brand.length>1 && car.brand.toLowerCase().includes(stored.brand.toLowerCase())) item.score+=20;
        }
      });
      list = list.filter(x=>x.score>-9000).sort((a,b)=>b.score-a.score).map(x=>x.c);
      return list;
    }

    function render(list){
      grid.innerHTML='';
      if(list.length===0){ grid.innerHTML='<p class="muted">No matches found.</p>'; return; }
      list.slice(0,80).forEach(c=>{
        const el = document.createElement('article'); el.className='card';
        el.innerHTML = `
          <img src="${c.image}" alt="${c.brand} ${c.model}" loading="lazy"/>
          <div class="card-body">
            <h3>${c.brand} ${c.model}</h3>
            <p>${c.body} • ${c.fuel} • ${c.seats} seats</p>
            <div class="price">₹${c.price} L</div>
            <div style="margin-top:8px">
              <button class="btn ghost" onclick="addToWishlist(${c.id})">♡ Wishlist</button>
              <button class="btn ghost" onclick="toggleCompare(${c.id})">☰ Compare</button>
              <a class="btn" href="details.html?id=${c.id}">Details</a>
            </div>
          </div>`;
        grid.appendChild(el);
      });
    }

    // public actions
    window.addToWishlist = function(id){ let arr = JSON.parse(localStorage.getItem('cf_wishlist')||'[]'); if(!arr.includes(id)) arr.push(id); localStorage.setItem('cf_wishlist', JSON.stringify(arr)); alert('Saved to wishlist'); };
    window.toggleCompare = function(id){ let arr = JSON.parse(localStorage.getItem('cf_compare')||'[]'); if(arr.includes(id)){ arr = arr.filter(x=>x!==id); } else { if(arr.length<4) arr.push(id); else { alert('Max 4 to compare'); return; } } localStorage.setItem('cf_compare', JSON.stringify(arr)); alert('Compare list updated'); };

    // wire filters
    ['searchInput','brandFilter','bodyFilter','fuelFilter','minPrice','maxPrice'].forEach(id=> document.getElementById(id).addEventListener('input', ()=>{ render(scoreAndFilter()); }));
    document.getElementById('clearFilters').addEventListener('click', ()=>{ document.getElementById('searchInput').value=''; document.getElementById('brandFilter').value=''; document.getElementById('bodyFilter').value=''; document.getElementById('fuelFilter').value=''; document.getElementById('minPrice').value=''; document.getElementById('maxPrice').value=''; render(scoreAndFilter()); });

    render(scoreAndFilter());
  });
  </script>
</body>
</html>
